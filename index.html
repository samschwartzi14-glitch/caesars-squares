<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Caesars Sportsbook - Super Bowl Squares</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Caesars Brand Colors */
      --gold: #D4AF37;
      --gold-light: #E8D090;
      --gold-dark: #B8941F;
      --navy: #0A2240;
      --navy-light: #1a3a5f;
      --white: #FFFFFF;
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      /* Status Colors */
      --available: #FFFFFF;
      --purchased: #FEF3C7;
      --purchased-border: #F59E0B;
      --q1-winner: #DBEAFE;
      --q1-border: #3B82F6;
      --q2-winner: #D1FAE5;
      --q2-border: #10B981;
      --q3-winner: #FED7AA;
      --q3-border: #F97316;
      --final-winner: #FDE68A;
      --final-border: #D4AF37;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--gray-50);
      color: var(--gray-900);
      line-height: 1.5;
    }

    .font-mono {
      font-family: 'JetBrains Mono', monospace;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
      padding: 1.5rem 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: 0.15em;
      color: var(--gold);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .subtitle {
      font-size: 0.875rem;
      color: var(--gold-light);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .status-badges {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .status-badge {
      background: rgba(255, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      color: var(--white);
      font-size: 0.875rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-badge.live {
      background: var(--q2-border);
      animation: pulse 2s ease-in-out infinite;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--white);
      border-radius: 50%;
      animation: ping 2s ease-in-out infinite;
    }

    /* Main Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Score Display */
    .score-section {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .score-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 2rem;
      align-items: center;
    }

    .team-score {
      text-align: center;
    }

    .team-name {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--navy);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .score {
      font-size: 4rem;
      font-weight: 900;
      color: var(--gold);
      font-family: 'JetBrains Mono', monospace;
      line-height: 1;
    }

    .vs-divider {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-300);
    }

    .quarter-info {
      text-align: center;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid var(--gray-200);
    }

    .quarter-badge {
      display: inline-block;
      background: var(--navy);
      color: var(--gold);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Simple Controls */
    .simple-controls {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .control-info {
      flex: 1;
      min-width: 200px;
    }

    .control-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gray-700);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .control-value {
      font-size: 1rem;
      font-weight: 700;
      color: var(--navy);
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    button {
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gold-dark), var(--gold));
      color: var(--navy);
      box-shadow: 0 2px 4px rgba(212, 175, 55, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(212, 175, 55, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--white);
      color: var(--navy);
      border: 2px solid var(--navy);
    }

    .btn-secondary:hover {
      background: var(--navy);
      color: var(--white);
    }

    /* Grid Section */
    .grid-section {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      overflow-x: auto;
    }

    .grid-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .grid-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--navy);
    }

    .grid-stats {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 900;
      color: var(--gold);
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--gray-700);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    /* Grid Container */
    .grid-wrapper {
      display: inline-block;
      min-width: 100%;
    }

   .grid-container {
  background: var(--navy);
  display: grid;
  grid-template-columns: 50px repeat(10, 1fr);
  grid-template-rows: 50px repeat(10, 1fr);
  gap: 0;
  border: 3px solid var(--navy);
  border-radius: 8px;
  overflow: hidden;
  min-width: 800px;
}

    /* Grid Cells */
    .cell {
      background: var(--available);
      border: 1px solid var(--navy);
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 1.25rem;
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
    }

.cell.header {
  background: var(--navy) !important;
  color: var(--gold) !important;
  font-weight: 900;
  cursor: default;
  font-size: 1.5rem !important;
  border: none !important;
  padding: 0 !important;
  line-height: 50px !important;
  display: block !important;
  text-align: center !important;
  margin: 0 !important;
  vertical-align: middle !important;
  aspect-ratio: auto !important;
  height: 100%;
}

.grid-container > .cell.header:not(.corner) {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 0 !important;
}

    .cell.corner {
      background: var(--gold);
      color: var(--navy);
      cursor: default;
      font-size: 0.75rem;
      font-weight: 900;
      border-color: var(--gold);
    }

    /* Square States */
    .cell.available {
      background: var(--available);
    }

    .cell.available:hover {
      background: var(--gray-100);
      transform: scale(1.05);
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .cell.purchased {
      background: var(--purchased);
      border: 2px solid var(--purchased-border);
      font-weight: 900;
    }

    .cell.purchased:hover {
      background: #FDE68A;
    }

    .cell.q1-winner {
      background: var(--q1-winner);
      border: 3px solid var(--q1-border);
      color: var(--q1-border);
      font-weight: 900;
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
    }

    .cell.q2-winner {
      background: var(--q2-winner);
      border: 3px solid var(--q2-border);
      color: var(--q2-border);
      font-weight: 900;
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
    }

    .cell.q3-winner {
      background: var(--q3-winner);
      border: 3px solid var(--q3-border);
      color: var(--q3-border);
      font-weight: 900;
      box-shadow: 0 0 15px rgba(249, 115, 22, 0.3);
    }

    .cell.final-winner {
      background: var(--final-winner);
      border: 3px solid var(--final-border);
      color: var(--navy);
      font-weight: 900;
      animation: winner-pulse 2s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
      z-index: 5;
    }

    .winner-label {
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 0.625rem;
      font-weight: 900;
      letter-spacing: 0.05em;
    }

    .winner-star {
      position: absolute;
      bottom: 2px;
      left: 4px;
      font-size: 1.25rem;
    }

    /* Legend */
    .legend {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      padding-top: 1.5rem;
      border-top: 2px solid var(--gray-200);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-box {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 2px solid var(--gray-300);
    }

    .legend-box.available {
      background: var(--available);
    }

    .legend-box.purchased {
      background: var(--purchased);
      border-color: var(--purchased-border);
    }

    .legend-box.q1 {
      background: var(--q1-winner);
      border-color: var(--q1-border);
    }

    .legend-box.q2 {
      background: var(--q2-winner);
      border-color: var(--q2-border);
    }

    .legend-box.q3 {
      background: var(--q3-winner);
      border-color: var(--q3-border);
    }

    .legend-box.final {
      background: var(--final-winner);
      border-color: var(--final-border);
    }

    .legend-text {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--gray-700);
    }

    /* Winner History */
    .winner-history {
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-top: 2rem;
    }

    .winner-history-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--navy);
      margin-bottom: 1rem;
    }

    .winner-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .winner-card {
      border: 3px solid var(--gray-200);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .winner-card.q1 {
      border-color: var(--q1-border);
      background: var(--q1-winner);
    }

    .winner-card.q2 {
      border-color: var(--q2-border);
      background: var(--q2-winner);
    }

    .winner-card.q3 {
      border-color: var(--q3-border);
      background: var(--q3-winner);
    }

    .winner-card.final {
      border-color: var(--final-border);
      background: var(--final-winner);
    }

    .winner-quarter {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-700);
      margin-bottom: 0.5rem;
    }

    .winner-score {
      font-size: 1.5rem;
      font-weight: 900;
      font-family: 'JetBrains Mono', monospace;
      color: var(--navy);
    }

    .winner-square {
      font-size: 0.875rem;
      color: var(--gray-700);
      margin-top: 0.25rem;
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }

    @keyframes ping {
      0%, 100% {
        opacity: 1;
        transform: scale(1);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.5);
      }
    }

    @keyframes winner-pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.03);
      }
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--navy);
      color: var(--gold);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease;
      z-index: 2000;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .header-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .logo {
        font-size: 1.5rem;
      }

      .score-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .vs-divider {
        display: none;
      }

      .score {
        font-size: 3rem;
      }

      .simple-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .grid-container {
        min-width: 600px;
      }

      .cell {
        font-size: 1rem;
      }

      .cell.header {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <div class="logo-section">
        <div>
          <div class="logo">CAESARS</div>
          <div class="subtitle">Super Bowl Squares</div>
        </div>
      </div>
      <div class="status-badges" id="status-badges">
        <div class="status-badge">
          <span id="board-id-display">Board: Loading...</span>
        </div>
      </div>
    </div>
  </div>
  
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;
// Supabase Configuration
const SUPABASE_URL = 'https://auzbvnpwewvrwgtrayx.supabase.co';
const SUPABASE_ANON_KEY = 'sb_secret_TxrSVSifZP6KMs3ie_UmGw_GBM9lG1_';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const GRID_SIZE = 10;
    
    function App() {
      const [boardId, setBoardId] = useState('');
      const [boardLoaded, setBoardLoaded] = useState(false);
      const supabaseChannelRef = useRef(null);
      const [renderKey, setRenderKey] = useState(0);
      const [grid, setGrid] = useState(() => 
        Array(GRID_SIZE).fill(null).map(() => 
          Array(GRID_SIZE).fill(null).map(() => ({ purchased: false }))
        )
      );
      const [rowNumbers, setRowNumbers] = useState(Array(GRID_SIZE).fill(null));
      const [colNumbers, setColNumbers] = useState(Array(GRID_SIZE).fill(null));
      const [numbersGenerated, setNumbersGenerated] = useState(false);
      
      const [homeTeam, setHomeTeam] = useState('');
      const [awayTeam, setAwayTeam] = useState('');
      const [homeScore, setHomeScore] = useState(0);
      const [awayScore, setAwayScore] = useState(0);
      const [quarter, setQuarter] = useState('Pre-Game');
      
      // Quarter-end scores (automatically captured)
      const [q1Score, setQ1Score] = useState(null);
      const [q2Score, setQ2Score] = useState(null);
      const [q3Score, setQ3Score] = useState(null);
      const [finalScore, setFinalScore] = useState(null);
      
      const [autoUpdate, setAutoUpdate] = useState(false);
      const [showToast, setShowToast] = useState(false);
      const [toastMessage, setToastMessage] = useState('');
      const lastQuarterRef = useRef('Pre-Game');

// Initialize board and load from Supabase  
useEffect(() => {
  const init = async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('board') || `SB${Date.now().toString().slice(-6)}`;
    setBoardId(id);
    document.getElementById('board-id-display').textContent = `Board: ${id}`;

    // Load from Supabase
    const { data } = await supabase.from('boards').select('data').eq('board_id', id).single();
    
    if (data?.data) {
      const d = data.data;
      if (d.grid) setGrid(d.grid);
      if (d.rowNumbers) setRowNumbers(d.rowNumbers);
      if (d.colNumbers) setColNumbers(d.colNumbers);
      if (d.numbersGenerated) setNumbersGenerated(d.numbersGenerated);
      if (d.homeTeam) setHomeTeam(d.homeTeam);
      if (d.awayTeam) setAwayTeam(d.awayTeam);
      if (d.homeScore !== undefined) setHomeScore(d.homeScore);
      if (d.awayScore !== undefined) setAwayScore(d.awayScore);
      if (d.quarter) { setQuarter(d.quarter); lastQuarterRef.current = d.quarter; }
      if (d.q1Score) setQ1Score(d.q1Score);
      if (d.q2Score) setQ2Score(d.q2Score);
      if (d.q3Score) setQ3Score(d.q3Score);
      if (d.finalScore) setFinalScore(d.finalScore);
    }

    setBoardLoaded(true);

    // Real-time subscription
    const channel = supabase.channel(`board-${id}`)
      .on('postgres_changes', { event: '*', schema: 'public', table: 'boards', filter: `board_id=eq.${id}` },
        (payload) => {
          if (payload.new?.data) {
            const d = payload.new.data;
            if (d.grid) setGrid(d.grid);
            if (d.rowNumbers) setRowNumbers(d.rowNumbers);
            if (d.colNumbers) setColNumbers(d.colNumbers);
            if (d.numbersGenerated) setNumbersGenerated(d.numbersGenerated);
            if (d.homeTeam) setHomeTeam(d.homeTeam);
            if (d.awayTeam) setAwayTeam(d.awayTeam);
            if (d.homeScore !== undefined) setHomeScore(d.homeScore);
            if (d.awayScore !== undefined) setAwayScore(d.awayScore);
            if (d.quarter) setQuarter(d.quarter);
            if (d.q1Score) setQ1Score(d.q1Score);
            if (d.q2Score) setQ2Score(d.q2Score);
            if (d.q3Score) setQ3Score(d.q3Score);
            if (d.finalScore) setFinalScore(d.finalScore);
          }
        }
      ).subscribe();

    supabaseChannelRef.current = channel;
    return () => { if (supabaseChannelRef.current) supabase.removeChannel(supabaseChannelRef.current); };
  };
  
  init();
}, []);
 // Save to Supabase
useEffect(() => {
  if (boardId && boardLoaded) {
    const data = {
      grid,
      rowNumbers,
      colNumbers,
      numbersGenerated,
      homeTeam,
      awayTeam,
      homeScore,
      awayScore,
      quarter,
      q1Score,
      q2Score,
      q3Score,
      finalScore
    };
    
    supabase.from('boards').upsert({
      board_id: boardId,
      data: data,
      updated_at: new Date().toISOString()
    });
  }
}, [boardId, boardLoaded, grid, rowNumbers, colNumbers, numbersGenerated, homeTeam, awayTeam, homeScore, awayScore, quarter, q1Score, q2Score, q3Score, finalScore]);

      // Fetch live scores from ESPN
      const fetchLiveScores = useCallback(async () => {
        try {
          const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
          const data = await response.json();
          
          const games = data.events || [];
          if (games.length > 0) {
            const game = games[0];
            const competitions = game.competitions[0];
            
            const home = competitions.competitors.find(t => t.homeAway === 'home');
            const away = competitions.competitors.find(t => t.homeAway === 'away');
            
            setHomeTeam(home.team.displayName);
            setAwayTeam(away.team.displayName);
            setHomeScore(parseInt(home.score) || 0);
            setAwayScore(parseInt(away.score) || 0);
            
            const status = competitions.status.type.detail;
            setQuarter(status);
          }
        } catch (error) {
          console.error('Error fetching scores:', error);
        }
      }, []);

      // Auto-capture quarter-end scores when quarter changes
      useEffect(() => {
        const prevQuarter = lastQuarterRef.current;
        
        // Detect quarter transitions and capture scores
        if (prevQuarter === '1st Quarter' && quarter !== '1st Quarter' && !q1Score) {
          setQ1Score({ home: homeScore, away: awayScore });
          showToastMessage(`Q1 Winner Locked! Score: ${awayScore}-${homeScore}`);
        } else if ((prevQuarter === '2nd Quarter' || prevQuarter === 'Halftime') && 
                   (quarter === 'Halftime' || quarter === '3rd Quarter') && !q2Score) {
          setQ2Score({ home: homeScore, away: awayScore });
          showToastMessage(`Q2 Winner Locked! Score: ${awayScore}-${homeScore}`);
        } else if (prevQuarter === '3rd Quarter' && quarter !== '3rd Quarter' && !q3Score) {
          setQ3Score({ home: homeScore, away: awayScore });
          showToastMessage(`Q3 Winner Locked! Score: ${awayScore}-${homeScore}`);
        } else if (quarter === 'Final' && !finalScore) {
          setFinalScore({ home: homeScore, away: awayScore });
          showToastMessage(`üèÜ Final Winner Locked! Score: ${awayScore}-${homeScore}`);
        }
        
        lastQuarterRef.current = quarter;
      }, [quarter, homeScore, awayScore, q1Score, q2Score, q3Score, finalScore]);

      // Auto-refresh scores
      useEffect(() => {
        if (autoUpdate) {
          const interval = setInterval(fetchLiveScores, 30000); // Every 30 seconds
          fetchLiveScores(); // Fetch immediately on enable
          return () => clearInterval(interval);
        }
      }, [autoUpdate, fetchLiveScores]);

      // Update live status badge
      useEffect(() => {
        const statusBadges = document.getElementById('status-badges');
        const existingLiveBadge = document.querySelector('.status-badge.live');
        
        if (autoUpdate && !existingLiveBadge) {
          const liveBadge = document.createElement('div');
          liveBadge.className = 'status-badge live';
          liveBadge.innerHTML = '<span class="live-dot"></span> LIVE AUTO-UPDATE';
          statusBadges.appendChild(liveBadge);
        } else if (!autoUpdate && existingLiveBadge) {
          existingLiveBadge.remove();
        }
      }, [autoUpdate]);

      // Generate random numbers
      const generateNumbers = () => {
        const numbers = Array.from({ length: 10 }, (_, i) => i);
        const shuffleArray = (arr) => {
          const newArr = [...arr];
          for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
          }
          return newArr;
        };
        
        // Generate two separate random sequences
        const rowNums = shuffleArray([...numbers]); // Independent copy for rows
        const colNums = shuffleArray([...numbers]); // Independent copy for columns
        
        console.log('Generated Row Numbers (Away Team):', rowNums);
        console.log('Generated Column Numbers (Home Team):', colNums);
        
        setRowNumbers(rowNums);
        setColNumbers(colNums);
        setNumbersGenerated(true);
        setRenderKey(prev => prev + 1); // Force re-render
        showToastMessage(`‚úì Numbers Generated! Board is ready.\nAway Row: ${rowNums.join('-')}\nHome Col: ${colNums.join('-')}`);
      };

      // Toggle square purchase
      const toggleSquare = (row, col) => {
        if (numbersGenerated) {
          showToastMessage('Cannot modify squares after numbers are generated!');
          return;
        }
        
        const newGrid = grid.map((r, i) => 
          r.map((cell, j) => 
            i === row && j === col 
              ? { ...cell, purchased: !cell.purchased }
              : cell
          )
        );
        setGrid(newGrid);
      };

      // Calculate winner for any score
      const getWinner = (homeScoreVal, awayScoreVal) => {
        if (!numbersGenerated || homeScoreVal === null || awayScoreVal === null) return null;
        const homeDigit = homeScoreVal % 10;
        const awayDigit = awayScoreVal % 10;
        const rowIndex = rowNumbers.indexOf(awayDigit);
        const colIndex = colNumbers.indexOf(homeDigit);
        if (rowIndex !== -1 && colIndex !== -1) {
          return { row: rowIndex, col: colIndex, homeDigit, awayDigit };
        }
        return null;
      };

      // Determine cell class based on state
      const getCellClass = (row, col) => {
        const cell = grid[row][col];
        
        // Check if this is a winning square for any quarter
        const currentWinner = getWinner(homeScore, awayScore);
        const q1Winner = q1Score ? getWinner(q1Score.home, q1Score.away) : null;
        const q2Winner = q2Score ? getWinner(q2Score.home, q2Score.away) : null;
        const q3Winner = q3Score ? getWinner(q3Score.home, q3Score.away) : null;
        const finalWinner = finalScore ? getWinner(finalScore.home, finalScore.away) : null;
        
        // Final winner takes precedence
        if (finalWinner && finalWinner.row === row && finalWinner.col === col) {
          return 'final-winner';
        }
        
        // Then Q3
        if (q3Winner && q3Winner.row === row && q3Winner.col === col) {
          return 'q3-winner';
        }
        
        // Then Q2
        if (q2Winner && q2Winner.row === row && q2Winner.col === col) {
          return 'q2-winner';
        }
        
        // Then Q1
        if (q1Winner && q1Winner.row === row && q1Winner.col === col) {
          return 'q1-winner';
        }
        
        // Purchased but not a winner yet
        if (cell.purchased) {
          return 'purchased';
        }
        
        return 'available';
      };

      const showToastMessage = (message) => {
        setToastMessage(message);
        setShowToast(true);
        setTimeout(() => setShowToast(false), 4000);
      };

      const purchasedCount = grid.flat().filter(cell => cell.purchased).length;
      const availableCount = 100 - purchasedCount;
      const shareUrl = `${window.location.origin}${window.location.pathname}?board=${boardId}`;

      return (
        <div className="container">
          {/* Score Section */}
          <div className="score-section">
            <div className="score-grid">
              <div className="team-score">
                <div className="team-name">{awayTeam || 'AWAY TEAM'}</div>
                <div className="score">{awayScore}</div>
              </div>
              
              <div className="vs-divider">VS</div>
              
              <div className="team-score">
                <div className="team-name">{homeTeam || 'HOME TEAM'}</div>
                <div className="score">{homeScore}</div>
              </div>
            </div>
            
            <div className="quarter-info">
              <div className="quarter-badge">{quarter}</div>
            </div>
          </div>

          {/* Simple Controls */}
          <div className="simple-controls">
            <div className="control-info">
              <div className="control-label">Share Link</div>
              <div className="control-value" style={{ fontSize: '0.875rem', cursor: 'pointer' }}
                onClick={() => {
                  navigator.clipboard.writeText(shareUrl);
                  showToastMessage('üìã Link copied to clipboard!');
                }}>
                {shareUrl}
              </div>
            </div>

            <div className="btn-group">
              <button 
                className="btn-primary"
                onClick={generateNumbers}
                disabled={numbersGenerated}
              >
                {numbersGenerated ? '‚úì Numbers Generated' : 'Generate Numbers'}
              </button>
              
              <button 
                className={autoUpdate ? 'btn-primary' : 'btn-secondary'}
                onClick={() => setAutoUpdate(!autoUpdate)}
              >
                {autoUpdate ? '‚ö° Auto-Update ON' : 'Start Auto-Update'}
              </button>

              {!autoUpdate && (
                <button 
                  className="btn-secondary"
                  onClick={fetchLiveScores}
                >
                  Refresh Scores Now
                </button>
              )}
            </div>
          </div>

          {/* Grid Section */}
          <div className="grid-section">
            <div className="grid-header">
              <h3 className="grid-title">Game Board</h3>
              <div className="grid-stats">
                <div className="stat">
                  <div className="stat-value">{purchasedCount}</div>
                  <div className="stat-label">Purchased</div>
                </div>
                <div className="stat">
                  <div className="stat-value">{availableCount}</div>
                  <div className="stat-label">Available</div>
                </div>
                <div className="stat">
                  <div className="stat-value">{((purchasedCount / 100) * 100).toFixed(0)}%</div>
                  <div className="stat-label">Sold</div>
                </div>
              </div>
            </div>

            <div className="grid-wrapper">
              <div className="grid-container">
                {/* Corner cell */}
                <div className="cell corner font-mono">SB</div>
                
                {/* Column headers (Home Team) - Render explicitly */}
                <div className="cell header">{typeof colNumbers[0] === 'number' ? colNumbers[0] : '?'}</div>
                <div className="cell header">{typeof colNumbers[1] === 'number' ? colNumbers[1] : '?'}</div>
                <div className="cell header">{typeof colNumbers[2] === 'number' ? colNumbers[2] : '?'}</div>
                <div className="cell header">{typeof colNumbers[3] === 'number' ? colNumbers[3] : '?'}</div>
                <div className="cell header">{typeof colNumbers[4] === 'number' ? colNumbers[4] : '?'}</div>
                <div className="cell header">{typeof colNumbers[5] === 'number' ? colNumbers[5] : '?'}</div>
                <div className="cell header">{typeof colNumbers[6] === 'number' ? colNumbers[6] : '?'}</div>
                <div className="cell header">{typeof colNumbers[7] === 'number' ? colNumbers[7] : '?'}</div>
                <div className="cell header">{typeof colNumbers[8] === 'number' ? colNumbers[8] : '?'}</div>
                <div className="cell header">{typeof colNumbers[9] === 'number' ? colNumbers[9] : '?'}</div>

                {/* Rows */}
                {grid.map((row, rowIndex) => (
                  <React.Fragment key={`row-${rowIndex}`}>
                    {/* Row header (Away Team) */}
                    <div className="cell header">
                      {typeof rowNumbers[rowIndex] === 'number' ? rowNumbers[rowIndex] : '?'}
                    </div>
                    
                    {/* Grid cells */}
                    {row.map((cell, colIndex) => {
                      const cellClass = getCellClass(rowIndex, colIndex);
                      const q1Winner = q1Score ? getWinner(q1Score.home, q1Score.away) : null;
                      const q2Winner = q2Score ? getWinner(q2Score.home, q2Score.away) : null;
                      const q3Winner = q3Score ? getWinner(q3Score.home, q3Score.away) : null;
                      const finalWinner = finalScore ? getWinner(finalScore.home, finalScore.away) : null;
                      
                      const isQ1 = q1Winner && q1Winner.row === rowIndex && q1Winner.col === colIndex;
                      const isQ2 = q2Winner && q2Winner.row === rowIndex && q2Winner.col === colIndex;
                      const isQ3 = q3Winner && q3Winner.row === rowIndex && q3Winner.col === colIndex;
                      const isFinal = finalWinner && finalWinner.row === rowIndex && finalWinner.col === colIndex;
                      
                      return (
                        <div
                          key={`cell-${rowIndex}-${colIndex}`}
                          className={`cell ${cellClass}`}
                          onClick={() => toggleSquare(rowIndex, colIndex)}
                          title={numbersGenerated ? (cell.purchased ? 'Purchased' : 'Available') : 'Click to toggle purchased/available'}
                        >
                          {isFinal && <span className="winner-star">‚òÖ</span>}
                          {isFinal && <span className="winner-label">FINAL</span>}
                          {isQ3 && !isFinal && <span className="winner-label">Q3</span>}
                          {isQ2 && !isFinal && <span className="winner-label">Q2</span>}
                          {isQ1 && !isFinal && <span className="winner-label">Q1</span>}
                        </div>
                      );
                    })}
                  </React.Fragment>
                ))}
              </div>
            </div>

            <div className="legend">
              <div className="legend-item">
                <div className="legend-box available"></div>
                <span className="legend-text">Available</span>
              </div>
              <div className="legend-item">
                <div className="legend-box purchased"></div>
                <span className="legend-text">Purchased</span>
              </div>
              <div className="legend-item">
                <div className="legend-box q1"></div>
                <span className="legend-text">Q1 Winner</span>
              </div>
              <div className="legend-item">
                <div className="legend-box q2"></div>
                <span className="legend-text">Q2 Winner</span>
              </div>
              <div className="legend-item">
                <div className="legend-box q3"></div>
                <span className="legend-text">Q3 Winner</span>
              </div>
              <div className="legend-item">
                <div className="legend-box final"></div>
                <span className="legend-text">Final Winner</span>
              </div>
            </div>
          </div>

          {/* Winner History */}
          {(q1Score || q2Score || q3Score || finalScore) && (
            <div className="winner-history">
              <h3 className="winner-history-title">üèÜ Quarter Winners</h3>
              <div className="winner-list">
                {q1Score && (() => {
                  const winner = getWinner(q1Score.home, q1Score.away);
                  return winner ? (
                    <div className="winner-card q1">
                      <div className="winner-quarter">1st Quarter</div>
                      <div className="winner-score">{q1Score.away} - {q1Score.home}</div>
                      <div className="winner-square">Square: {winner.awayDigit}-{winner.homeDigit}</div>
                    </div>
                  ) : null;
                })()}

                {q2Score && (() => {
                  const winner = getWinner(q2Score.home, q2Score.away);
                  return winner ? (
                    <div className="winner-card q2">
                      <div className="winner-quarter">2nd Quarter</div>
                      <div className="winner-score">{q2Score.away} - {q2Score.home}</div>
                      <div className="winner-square">Square: {winner.awayDigit}-{winner.homeDigit}</div>
                    </div>
                  ) : null;
                })()}

                {q3Score && (() => {
                  const winner = getWinner(q3Score.home, q3Score.away);
                  return winner ? (
                    <div className="winner-card q3">
                      <div className="winner-quarter">3rd Quarter</div>
                      <div className="winner-score">{q3Score.away} - {q3Score.home}</div>
                      <div className="winner-square">Square: {winner.awayDigit}-{winner.homeDigit}</div>
                    </div>
                  ) : null;
                })()}

                {finalScore && (() => {
                  const winner = getWinner(finalScore.home, finalScore.away);
                  return winner ? (
                    <div className="winner-card final">
                      <div className="winner-quarter">üèÜ Final Score</div>
                      <div className="winner-score">{finalScore.away} - {finalScore.home}</div>
                      <div className="winner-square">Square: {winner.awayDigit}-{winner.homeDigit}</div>
                    </div>
                  ) : null;
                })()}
              </div>
            </div>
          )}

          {showToast && (
            <div className="toast">
              {toastMessage}
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
